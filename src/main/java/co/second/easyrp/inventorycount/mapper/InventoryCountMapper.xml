<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="co.second.easyrp.inventorycount.mapper.InventoryCountMapper">
	<select id="inventoryCountList">
		SELECT 
			ic.cod,
			e.name AS employee,
			w.name AS warehouse,
			l.name AS location,
			ic.count_date,
			ic.inv_date,
			ic.countclass,
			ic.account,
			ic.note
		FROM inventorycountdetail icd
		LEFT JOIN inventory i
		ON icd.inv_cod = i.cod
		LEFT JOIN product p
		ON icd.product_cod=p.cod
		LEFT JOIN inventorycount ic
		ON icd.count_cod=ic.cod
		LEFT JOIN employee e
		ON ic.employee_cod = e.cod
		LEFT JOIN warehouse w
		ON ic.warehouse_cod = w.cod
		LEFT JOIN location l
		ON ic.location_cod = l.cod
		WHERE deleteyn = 'N'
		<if test="searchCod != null and searchCod != ''">
			AND cod = #{cod}
		</if>
		<if test="employee != null and employee != ''">
			AND employee LIKE CONCAT('%', #{employee}, '%')
		</if>
		<if test="warehouse != null and warehouse != ''">
			AND warehouse LIKE CONCAT('%', #{warehouse}, '%')
		</if>
		<if test="location != null and location != ''">
			AND location LIKE CONCAT('%', #{location}, '%')
		</if>
		<if test="invCod != null and invCod != ''">
			AND inv_cod = #{invCod}
		</if>
		<if test="preSearchDate != null and postSearchDate != null">
			AND ic.count_date BETWEEN #{preSearchDate} AND #{postSearchDate}
		</if>
		ORDER BY ic.cod, icd.cod DESC
		LIMIT #{pageSize} OFFSET #{offset}
	</select>
	<select id="countInventoryCountLists">
		SELECT count(*)
		FROM inventorycountdetail icd
		LEFT JOIN inventory i
		ON icd.inv_cod = i.cod
		LEFT JOIN product p
		ON icd.product_cod=p.cod
		LEFT JOIN inventorycount ic
		ON icd.count_cod=ic.cod
		LEFT JOIN employee e
		ON ic.employee_cod = e.cod
		LEFT JOIN warehouse w
		ON ic.warehouse_cod = w.cod
		LEFT JOIN location l
		ON ic.location_cod = l.cod
		WHERE deleteyn = 'N'
		<if test="searchCod != null and searchCod != ''">
			AND cod = #{cod}
		</if>
		<if test="employee != null and employee != ''">
			AND employee LIKE CONCAT('%', #{employee}, '%')
		</if>
		<if test="warehouse != null and warehouse != ''">
			AND warehouse LIKE CONCAT('%', #{warehouse}, '%')
		</if>
		<if test="location != null and location != ''">
			AND location LIKE CONCAT('%', #{location}, '%')
		</if>
		<if test="invCod != null and invCod != ''">
			AND inv_cod = #{invCod}
		</if>
		<if test="preSearchDate != null and postSearchDate != null">
			AND ic.count_date BETWEEN #{preSearchDate} AND #{postSearchDate}
		</if>
		</select>
</mapper>